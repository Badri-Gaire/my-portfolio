---
import BaseLayout from "../layouts/BaseLayout.astro";
import Hero from "../components/features/home/Hero.astro";
import Skills from "../components/features/home/Skills.astro";
import About from "../components/features/home/About.astro";
import Experience from "../components/features/home/Experience.astro";
import Projects from "../components/features/home/Projects.astro";
import BlogCard from "../components/features/home/BlogCard.astro";
import BadriHeroImage from "../assets/images/badri2.webp";
import { getImage } from "astro:assets";

const heroImage = await getImage({
  src: BadriHeroImage,
  width: 600,
  format: "avif",
});

const blurPlaceholder = await getImage({
  src: BadriHeroImage,
  width: 20,
  quality: 10,
  format: "avif",
});

const imageProps = {
  src: heroImage.src,
  placeholder: blurPlaceholder.src,
};
---

<BaseLayout heroImage={BadriHeroImage}>
  <!-- Images and title -->
  <Hero imageData={imageProps} />
  <!-- All skills sections -->
  <Skills />
  <!-- Experiences sections -->
  <Experience />
  <!-- ALl my projects -->
  <Projects />
  <!-- All my blog -->
  <BlogCard home="true" />
  <!-- About me -->
  <About />
</BaseLayout>

<!--  Defer GSAP animations -->
<script>
  // Only run after page is interactive
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initAnimations);
  } else {
    requestIdleCallback
      ? requestIdleCallback(initAnimations)
      : setTimeout(initAnimations, 1);
  }

  function initAnimations() {
    import("gsap").then(({ gsap }) => {
      import("gsap/ScrollTrigger").then(({ ScrollTrigger }) => {
        import("gsap/ScrollToPlugin").then(({ ScrollToPlugin }) => {
          gsap.registerPlugin(ScrollTrigger, ScrollToPlugin);

          const animateElements =
            document.querySelectorAll(".animate-on-scroll");
          animateElements.forEach((element) => {
            gsap.to(element, {
              scrollTrigger: {
                trigger: element,
                start: "top 85%",
                toggleActions: "play none none reverse",
              },
              y: 0,
              opacity: 1,
              duration: 0.8,
              ease: "power3.out",
            });
          });

          // Smooth scroll
          const anchors = document.querySelectorAll('a[href^="#"]');
          anchors.forEach((anchor) => {
            anchor.addEventListener("click", (e) => {
              e.preventDefault();
              const targetId = (
                e.currentTarget as HTMLAnchorElement
              ).getAttribute("href");
              if (!targetId || targetId === "#") return;
              const targetElement = document.querySelector(targetId);
              if (targetElement) {
                gsap.to(window, {
                  duration: 1,
                  scrollTo: { y: targetElement, offsetY: 80 },
                  ease: "power2.inOut",
                });
              }
            });
          });
        });
      });
    });
  }
</script>
