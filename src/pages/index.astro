---
import BaseLayout from "../layouts/BaseLayout.astro";
import Hero from "../components/features/home/Hero.astro";
import Skills from "../components/features/home/Skills.astro";
import About from "../components/features/home/About.astro";
import Experience from "../components/features/home/Experience.astro";
import Projects from "../components/features/home/Projects.astro";
import BlogCard from "../components/features/home/BlogCard.astro";
import BadriHeroImage from "../assets/images/badri-arthero.webp";
---

<BaseLayout heroImage={BadriHeroImage}>
  <Hero />
  <Skills />
  <Experience />
  <Projects />
  <BlogCard home="true" />
  <About />
</BaseLayout>

<script>
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initAnimations);
  } else {
    requestIdleCallback
      ? requestIdleCallback(initAnimations)
      : setTimeout(initAnimations, 1);
  }

  function initAnimations() {
    import("gsap").then(({ gsap }) => {
      import("gsap/ScrollTrigger").then(({ ScrollTrigger }) => {
        import("gsap/ScrollToPlugin").then(({ ScrollToPlugin }) => {
          gsap.registerPlugin(ScrollTrigger, ScrollToPlugin);

          // Hero Animations
          const tl = gsap.timeline({ defaults: { ease: "power3.out" } });

          tl.to(".hero-bg-text", { opacity: 0.05, duration: 2 })
            .to(
              ".hero-image-container",
              { opacity: 1, y: 0, duration: 1.2 },
              "-=1.5",
            )
            .to(".hero-badge", { opacity: 1, y: 0, duration: 0.8 }, "-=0.8")
            .to(".hero-title", { opacity: 1, y: 0, duration: 0.8 }, "-=0.6")
            .to(
              ".hero-description",
              { opacity: 1, y: 0, duration: 0.8 },
              "-=0.6",
            )
            .to(".hero-cta", { opacity: 1, y: 0, duration: 0.8 }, "-=0.6");

          // Scroll Animations
          const animateElements =
            document.querySelectorAll(".animate-on-scroll");
          animateElements.forEach((element) => {
            gsap.to(element, {
              scrollTrigger: {
                trigger: element,
                start: "top 85%",
                toggleActions: "play none none reverse",
              },
              y: 0,
              opacity: 1,
              duration: 0.8,
              ease: "power3.out",
            });
          });

          // Smooth scroll
          const anchors = document.querySelectorAll('a[href^="#"]');
          anchors.forEach((anchor) => {
            anchor.addEventListener("click", (e) => {
              e.preventDefault();
              const targetId = (
                e.currentTarget as HTMLAnchorElement
              ).getAttribute("href");
              if (!targetId || targetId === "#") return;
              const targetElement = document.querySelector(targetId);
              if (targetElement) {
                gsap.to(window, {
                  duration: 1,
                  scrollTo: { y: targetElement, offsetY: 80 },
                  ease: "power2.inOut",
                });
              }
            });
          });
        });
      });
    });
  }
</script>
